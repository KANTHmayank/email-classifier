# Email Classification API

A FastAPI-based service that masks PII (names, emails, phone numbers, Aadhar, credit cards, etc.) using Regex and classifies support emails into predefined categories using OpenAI’s few-shot prompting.

---

## 🚀 Features

- **PII Masking**: Detects and masks full names, email addresses, phone numbers, Aadhar numbers, credit/debit cards, CVV, expiry dates, DOB using Regex.
- **Few-Shot Classification**: Embeds a handful of real examples from your dataset into each prompt to GPT-3.5/GPT-3 for accurate classification without fine-tuning.
- **FastAPI Endpoints**:  
  - `POST /classify`: upload an email body, returns masked text, list of entities, and predicted category.
- **Interactive Docs**: Swagger UI (`/docs`) auto-generated by FastAPI.

---

## 📂 Project Structure

email_classifier/ ├── app.py # Entry point: starts Uvicorn, prints docs URLs ├── api.py # FastAPI router, Pydantic request/response models ├── models.py # Loads your dataset, builds few-shot prompt, calls OpenAI ├── utils.py # Regex-based PII detection & masking logic ├── data/ │ └── combined_emails_with_natural_pii.xlsx # Provided email dataset (failed to commit) ├── requirements.txt # Python dependencies ├── .env # Environment variables (not committed) └── README.md # This file


---

## 🛠️ Requirements

- Python 3.8+
- An OpenAI API key
- Dependencies (install via `requirements.txt`):


---

## ⚙️ Setup & Local Development

1. **Clone the repository**  
 git clone https://github.com/<your-org>/email_classifier.git
 cd email_classifier

2. Create & activate a virtual environment (recommended)
   python -m venv venv
   source venv/bin/activate    # Linux / macOS
   venv\Scripts\activate       # Windows

3. Install dependencies
   pip install -r requirements.txt

4. Add your .env file at project root with:
   OPENAI_API_KEY=your_openai_key_here
             OR
   You can create .streamlit\secrets.toml file in your directory

5. Place the dataset
Ensure your provided Excel is at:

data/combined_emails_with_natural_pii.xlsx


▶️ Running the Server
uvicorn app:app --reload

Host binding: If you’re testing from another machine or inside a VM/container, bind to all interfaces:
uvicorn app:app --reload --host 0.0.0.0
and then visit http://<your-machine-IP>:8000/docs.


You’ll see in your terminal:

INFO: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)

🚀 Swagger UI available at
→ https://kanthmayank-email-classifier.hf.space/docs


📖 API Usage
1. Swagger UI
Visit https://kanthmayank-email-classifier.hf.space/docs

Expand POST /classify

Click “Try it out”, paste your JSON, then “Execute”.


2. Sample Request
   POST /classify
Content-Type: application/json

{
  "input_email_body": "Hi, I’m Mayank Kanth. My Aadhar no. is 263846284637. Please update my details."
}

3.  Sample Response
   {
  "input_email_body": "Hi, I’m Mayank Kanth. My Aadhar no. is 263846284637. Please update my details.",
  "list_of_masked_entities": [
    {
      "position": [4, 17],
      "classification": "full_name",
      "entity": "Mayank Kanth"
    },
    {
      "position": [31, 43],
      "classification": "aadhar_num",
      "entity": "263846284637"
    }
  ],
  "masked_email": "Hi, I’m [full_name]. My Aadhar no. is [aadhar_num]. Please update my details.",
  "category_of_the_email": "Account Management"
}



🎯 How It Works

1. Data Loading (models.py): loads your Excel, samples a few examples per category.

2. Few-Shot Prompt: embeds those examples in every OpenAI prompt.

3. PII Masking (utils.py): applies ordered regex patterns to detect & mask:

full_name (2–3 capitalized words)

email, dob, aadhar_num, credit_debit_no, expiry_no, phone_number, cvv_no

Ensures no overlapping matches.

4. FastAPI (api.py + app.py):

Defines request/response models.

Masks PII, calls classify_email(), and returns structured JSON.



Happy coding! 🚀
